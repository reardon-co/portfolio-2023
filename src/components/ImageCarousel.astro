---
interface Props {
  images: {
    src: string;
    alt: string;
  }[];
}

const { images } = Astro.props;
---

<section class="carousel" aria-label="Gallery">
  <ol class="carousel__viewport">
    {
      images.map((image) => (
        <li class="carousel-slide">
          <img src={image.src} alt={image.alt} class="image" />
          <div class="carousel__snapper" />
        </li>
      ))
    }
  </ol>
</section>

<style>
  @keyframes tonext {
    75% {
      left: 0;
    }
    95% {
      left: 100%;
    }
    98% {
      left: 100%;
    }
    99% {
      left: 0;
    }
  }

  @keyframes tostart {
    75% {
      left: 0;
    }
    95% {
      left: -900%;
    }
    98% {
      left: -900%;
    }
    99% {
      left: 0;
    }
  }

  @keyframes snap {
    96% {
      scroll-snap-align: center;
    }
    97% {
      scroll-snap-align: none;
    }
    99% {
      scroll-snap-align: none;
    }
    100% {
      scroll-snap-align: center;
    }
  }

  * {
    box-sizing: border-box;
    scrollbar-color: transparent transparent; /* thumb and track color */
    scrollbar-width: 0px;
  }

  ol,
  li {
    list-style: none;
    margin: 0;
    padding: 0;
    scrollbar-width: 0px;
    box-sizing: content-box;
  }

  .carousel__viewport {
    width: 100%;
    display: flex;
    overflow-x: scroll;
    scroll-behavior: smooth;
    scroll-snap-type: x mandatory;
  }

  .carousel-slide {
    position: relative;
    flex: 0 0 100%;
    width: 100%;
  }

  .image {
    object-fit: contain;
    width: 100%;
    height: auto;
  }

  .carousel__snapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    scroll-snap-align: center;
  }

  @media (hover: hover) {
    .carousel__snapper {
      animation-name: tonext, snap;
      animation-timing-function: ease;
      animation-duration: 4s;
      animation-iteration-count: infinite;
    }

    .carousel-slide:last-child .carousel__snapper {
      animation-name: tostart, snap;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .carousel__snapper {
      animation-name: none;
    }
  }
</style>

<script>
  document
    .querySelector(".carousel__viewport")
    ?.addEventListener("wheel", preventScroll, { passive: false });

  function preventScroll(e: Event) {
    e.preventDefault();
    e.stopPropagation();

    return false;
  }
</script>
